@model List<CapstoneProject.Group>
@{
    ViewBag.Title = "Groups";
}

<h2>Groups</h2>
@{string userType = Session["UserType"] != null ? Session["UserType"].ToString() : "";  }

<br />
<table class="table">
    <tr>
        <th>
            @Html.DisplayNameFor(model => model[0].GroupName)
        </th>
        <th>
            @Html.DisplayNameFor(model => model[0].Description)
        </th>
        <th>
            Members
        </th>
        <th>

        </th>
    </tr>

    @foreach (var group in Model)
    {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => group.GroupName)
            </td>
            <td>
                @Html.DisplayFor(modelItem => group.Description)
            </td>
            <td>
                @group.Students.Count() / 4
            </td>
            @{
                if (userType.Equals("Admin"))
                {
                    <td>
                        @Html.ActionLink("View", "Details", new { id = group.GroupId }, new { @class = "btn btn-info" })
                        &nbsp;
                        
                        <button type="button" class="btn btn-danger btnDelGroup" data-toggle="modal" data-target="#deleteModal">Delete</button>
                        <input type="hidden" name="hdnSelectedGroup" id="hdnSelectedGroup">
                     </td>
                }
            }
        </tr>
                }

</table>
<!-- Modal -->
<div id="deleteModal" class="modal fade" role="dialog" tabindex="-1">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Delete Group?</h4>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this group?</p>
            </div>
            <div class="modal-footer">
                <button type="button" id="deleteGroup" class="btn btn-primary">Leave</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
     $(document).ready(function () {
         $(".btnDelGroup").on("click", function () {
            $("#hdnSelectedGroup").val(this.id);
        });
        $('#deleteGroup').on('click', function (e) {
            var cId = $("#hdnSelectedGroup").val();
            $.ajax({
                url: '/Coops/DeleteCoop',
                type: 'POST',
                dataType: 'text',
                data: {
                    id: cId
                },
                success: function (data) {
                    window.location.href = "/Students/Index";
                }
            });


        });
    });
</script>
